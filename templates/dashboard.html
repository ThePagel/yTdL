{% extends "layout.html" %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<h2>Welcome to the Dashboard</h2>
<ul>
    <li><a href="{{ url_for('user_management') }}">User Management</a></li>
    <li><a href="{{ url_for('profile') }}">Profile</a></li>
    <li><a href="{{ url_for('logout') }}">Logout</a></li>
</ul>

<h3>Create a Playlist</h3>
<form method="POST" action="{{ url_for('create_playlist') }}">
    {{ form.hidden_tag() }}
    <div class="form-group">
        <label for="artist">Enter the artist name:</label>
        <input type="text" id="artist" name="artist" onkeyup="fetchArtists()" autocomplete="off">
        <div id="artist-suggestions" class="autocomplete-items"></div>
    </div>
    <div class="form-group">
        <label for="song">Select a song:</label>
        <select id="song" name="song">
            <option value="">--Select a song--</option>
        </select>
    </div>
    <div class="form-group">
        <button type="submit">Create Playlist</button>
    </div>
</form>

<script>
function fetchArtists() {
    const query = document.getElementById('artist').value;
    if (query.length > 2) {
        fetch(`/get_artists?query=${query}`)
            .then(response => response.json())
            .then(data => {
                const artistSuggestions = document.getElementById('artist-suggestions');
                artistSuggestions.innerHTML = '';
                data.artists.forEach(artist => {
                    const div = document.createElement('div');
                    div.textContent = artist;
                    div.onclick = function() {
                        document.getElementById('artist').value = artist;
                        artistSuggestions.innerHTML = '';
                        fetchSongs();
                    };
                    artistSuggestions.appendChild(div);
                });
            });
    }
}

function fetchSongs() {
    const artist = document.getElementById('artist').value;
    if (artist.length > 2) {
        fetch(`/get_songs?artist=${artist}`)
            .then(response => response.json())
            .then(data => {
                const songSelect = document.getElementById('song');
                songSelect.innerHTML = '<option value="">--Select a song--</option>';
                data.songs.forEach(song => {
                    const option = document.createElement('option');
                    option.value = song;
                    option.textContent = song;
                    songSelect.appendChild(option);
                });
            });
    }
}
</script>

<style>
.autocomplete-items {
    border: 1px solid #d4d4d4;
    border-bottom: none;
    border-top: none;
    z-index: 99;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
}

.autocomplete-items div {
    padding: 10px;
    cursor: pointer;
    background-color: #fff;
    border-bottom: 1px solid #d4d4d4;
}

.autocomplete-items div:hover {
    background-color: #e9e9e9;
}
</style>
{% endblock %}
